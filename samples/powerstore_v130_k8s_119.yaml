apiVersion: storage.dell.com/v1
kind: CSIPowerStore
metadata:
  name: test-powerstore
  namespace: test-powerstore
spec:
  driver:
    # Config version for CSI PowerStore v1.3 driver
    configVersion: v3
    # Controller count
    replicas: 2
    forceUpdate: false
    common:
      # Image for CSI PowerStore driver v1.3
      image: "dellemc/csi-powerstore:v1.3.0"
      imagePullPolicy: IfNotPresent
      envs:
        - name: X_CSI_POWERSTORE_NODE_NAME_PREFIX
          value: "csi"
        - name: X_CSI_FC_PORTS_FILTER_FILE_PATH
          value: "/etc/fc-ports-filter"
    node:
      envs:
        # Set to "true" to enable ISCSI CHAP Authentication
        # CHAP password will be autogenerated by driver
        - name: "X_CSI_POWERSTORE_ENABLE_CHAP"
          value: "true"
    storageClass:
      - name: powerstore
        default: true
        reclaimPolicy: "Delete"
        parameters:
          FsType: ext4
      - name: powerstore-xfs
        reclaimPolicy: "Delete"
        parameters:
          FsType: xfs
          arrayIP: "127.0.0.1"
      - name: powerstore-nfs
        reclaimPolicy: "Delete"
        parameters:
          FsType: nfs
          arrayIP: "127.0.0.1"
        # Copy to other storage classes if you want to configure topology constraints for them
        allowedTopologies:
          - matchLabelExpressions:
              # Replace 127.0.0.1 with PowerStore same array IP you specified for this storage class in arrayIP: parameter
              # And append -nfs, -fc or -iscsi at the end of it
              - key: csi-powerstore.dellemc.com/127.0.0.1-nfs
                values:
                  - "true"
    snapshotClass:
      - name: powerstore-snapshot
